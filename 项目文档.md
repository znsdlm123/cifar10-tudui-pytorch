# CIFAR-10 图像分类项目文档

## 项目概述

本项目是一个基于 PyTorch 的 CIFAR-10 图像分类项目。CIFAR-10 数据集包含 10 个类别的 32×32 彩色图像，共 60,000 张训练图像和 10,000 张测试图像。

**项目目标：** 训练一个卷积神经网络（CNN）模型，能够对 CIFAR-10 数据集中的 10 个类别进行准确分类。

## 核心文件说明

### 1. 模型定义文件

#### `model.py`
- **功能：** 定义了 `Tudui` 卷积神经网络模型类
- **模型结构：**
  - 3 个卷积层（Conv2d）：3→32→32→64 通道
  - 3 个最大池化层（MaxPool2d）：2×2 池化
  - 2 个全连接层（Linear）：1024→64→10
  - 输入：32×32×3 的彩色图像
  - 输出：10 个类别的分类概率
- **作用：** 项目核心模型架构定义

### 2. 训练脚本文件

#### `train.py`
- **功能：** CPU 版本的完整训练脚本
- **主要功能：**
  - 加载 CIFAR-10 数据集
  - 创建数据加载器（DataLoader）
  - 实例化模型、损失函数（CrossEntropyLoss）、优化器（SGD）
  - 训练 10 个 epoch
  - 每个 epoch 进行训练和测试
  - 记录训练损失、测试损失和准确率到 TensorBoard
  - 保存每个 epoch 的模型（`tudui_0.pth` ~ `tudui_9.pth`）
- **使用场景：** 在没有 GPU 或需要 CPU 训练时使用

#### `train_gpu_1.py`
- **功能：** GPU 训练脚本（使用 `.cuda()` 方法）
- **特点：**
  - 使用 `torch.cuda.is_available()` 检测 GPU 可用性
  - 将模型、损失函数、数据转移到 GPU
  - 包含训练时间统计
  - 模型定义内嵌在文件中
- **使用场景：** 需要在 GPU 上训练时使用

#### `train_gpu_2.py`
- **功能：** GPU 训练脚本（使用 `.to(device)` 方法）
- **特点：**
  - 使用 `torch.device("cuda:0")` 指定设备
  - 使用 `.to(device)` 方法转移模型和数据到 GPU
  - 更现代的 PyTorch 设备管理方式
  - 模型定义内嵌在文件中
- **使用场景：** 推荐的 GPU 训练方式

### 3. 数据处理文件

#### `dataset_transform.py`
- **功能：** 数据集加载和可视化
- **主要功能：**
  - 定义数据变换（ToTensor）
  - 加载 CIFAR-10 训练集和测试集
  - 使用 TensorBoard 可视化前 10 张测试图像
  - 显示图像类别信息

#### `dataloader.py`
- **功能：** 数据加载器测试和可视化
- **主要功能：**
  - 创建 DataLoader 并设置参数（batch_size=64, shuffle=True）
  - 测试数据加载流程
  - 使用 TensorBoard 可视化数据批次
- **作用：** 用于验证数据加载是否正确

### 4. 模型保存与加载文件

#### `model_save.py`
- **功能：** 演示模型保存的两种方式
- **保存方式：**
  1. `torch.save(model, "model.pth")` - 保存完整模型（结构+参数）
  2. `torch.save(model.state_dict(), "model.pth")` - 仅保存参数（推荐）
- **作用：** 学习模型保存的最佳实践

#### `model_load.py`
- **功能：** 演示模型加载方法
- **加载方式：**
  1. `torch.load("model.pth")` - 加载完整模型
  2. `model.load_state_dict(torch.load("model.pth"))` - 加载参数到模型结构
- **作用：** 学习模型加载的正确方法

#### `model_pretrained.py`
- **功能：** 演示如何使用预训练模型（VGG16）
- **主要功能：**
  - 加载预训练 VGG16 模型
  - 修改分类器以适应 CIFAR-10（10 个类别）
  - 演示模型微调方法

### 5. 模型推理文件

#### `src/test.py`
- **功能：** 使用训练好的模型进行图像分类推理
- **主要功能：**
  - 加载训练好的模型（`tudui_0.pth`）
  - 对单张图像进行预处理（Resize、ToTensor）
  - 进行模型推理
  - 输出预测结果
- **使用场景：** 测试训练好的模型在实际图像上的表现

## 项目结构

```
tudui2_pytorch/
│
├── 核心文件
│   ├── model.py                  # 模型定义
│   ├── train.py                  # CPU 训练脚本
│   ├── train_gpu_1.py            # GPU 训练脚本（方法1）
│   ├── train_gpu_2.py            # GPU 训练脚本（方法2）
│   ├── dataset_transform.py      # 数据集转换
│   ├── dataloader.py             # 数据加载器
│   ├── model_save.py             # 模型保存示例
│   ├── model_load.py             # 模型加载示例
│   ├── model_pretrained.py       # 预训练模型示例
│   └── src/test.py               # 模型推理测试
│
├── 数据目录
│   ├── data/                     # CIFAR-10 数据集（训练用）
│   └── dataset/                  # CIFAR-10 数据集（测试用）
│
├── 模型文件
│   ├── tudui_0.pth ~ tudui_9.pth # 训练保存的模型
│   ├── vgg16_method1.pth         # VGG16 完整模型
│   └── vgg16_method2.pth         # VGG16 参数模型
│
├── 日志目录
│   ├── logs/                     # TensorBoard 训练日志
│   ├── dataloader/               # 数据加载器日志
│   ├── p10/                      # 数据集可视化日志
│   ├── logs_maxpool/             # MaxPool 相关日志
│   ├── logs_relu/                # ReLU 相关日志
│   └── logs_seq/                 # Sequential 相关日志
│
└── 其他文件
    ├── nn_*.py                   # 神经网络组件学习文件
    └── img/                      # 测试图像
```

## 使用方法

### 1. 环境准备

```bash
# 安装所需依赖
pip install torch torchvision tensorboard pillow
```

### 2. 训练模型

#### CPU 训练
```bash
python train.py
```

#### GPU 训练（方法1）
```bash
python train_gpu_1.py
```

#### GPU 训练（方法2，推荐）
```bash
python train_gpu_2.py
```

### 3. 查看训练过程

```bash
# 启动 TensorBoard
tensorboard --logdir=logs

# 在浏览器中打开 http://localhost:6006
```

### 4. 模型推理

```bash
# 使用训练好的模型进行推理
python src/test.py
```

### 5. 可视化数据集

```bash
# 可视化数据集
python dataset_transform.py
tensorboard --logdir=p10

# 可视化数据加载器
python dataloader.py
tensorboard --logdir=dataloader
```

## 模型架构

### Tudui 模型结构

```
输入: (batch_size, 3, 32, 32)
    ↓
Conv2d(3, 32, kernel_size=5, padding=2)
    ↓
MaxPool2d(2)
    ↓
Conv2d(32, 32, kernel_size=5, padding=2)
    ↓
MaxPool2d(2)
    ↓
Conv2d(32, 64, kernel_size=5, padding=2)
    ↓
MaxPool2d(2)
    ↓
Flatten()
    ↓
Linear(1024, 64)
    ↓
Linear(64, 10)
    ↓
输出: (batch_size, 10)
```

### 模型参数

- **输入尺寸：** 32×32×3（CIFAR-10 标准尺寸）
- **输出类别：** 10 类
- **损失函数：** CrossEntropyLoss（交叉熵损失）
- **优化器：** SGD（随机梯度下降）
- **学习率：** 0.01
- **批次大小：** 64
- **训练轮次：** 10 epochs

## CIFAR-10 数据集类别

1. airplane（飞机）
2. automobile（汽车）
3. bird（鸟）
4. cat（猫）
5. deer（鹿）
6. dog（狗）
7. frog（青蛙）
8. horse（马）
9. ship（船）
10. truck（卡车）

## 训练流程

1. **数据准备**
   - 下载 CIFAR-10 数据集
   - 转换为 Tensor 格式
   - 创建 DataLoader

2. **模型初始化**
   - 实例化 Tudui 模型
   - 定义损失函数和优化器

3. **训练循环**
   - 每个 epoch：
     - 训练模式：前向传播 → 计算损失 → 反向传播 → 参数更新
     - 评估模式：在测试集上评估模型性能
     - 记录损失和准确率
     - 保存模型

4. **模型评估**
   - 计算测试集准确率
   - 可视化训练过程

## 项目特点

1. **完整的训练流程：** 从数据加载到模型保存的完整实现
2. **GPU 支持：** 提供多种 GPU 训练方式
3. **可视化支持：** 使用 TensorBoard 记录和可视化训练过程
4. **模型管理：** 完整的模型保存和加载示例
5. **代码规范：** 清晰的文件组织和注释

## 注意事项

1. **模型保存：** 
   - `train.py` 使用完整模型保存方式
   - 加载时需要导入模型类定义
   - 推荐使用 `state_dict()` 方式保存

2. **GPU 使用：**
   - 确保已安装 CUDA 版本的 PyTorch
   - 使用 `torch.cuda.is_available()` 检查 GPU 可用性
   - 推荐使用 `.to(device)` 方法

3. **数据路径：**
   - 训练脚本使用 `./data` 目录
   - 部分脚本使用 `./dataset` 目录
   - 首次运行会自动下载数据集

4. **模型推理：**
   - 确保模型文件路径正确
   - 如果模型在 GPU 上训练，加载时需要使用 `map_location` 参数

## 扩展建议

1. **数据增强：** 添加随机翻转、裁剪等数据增强技术
2. **模型优化：** 尝试不同的网络架构（ResNet、VGG 等）
3. **超参数调优：** 调整学习率、批次大小等参数
4. **正则化：** 添加 Dropout、BatchNorm 等正则化技术
5. **学习率调度：** 使用学习率衰减策略

## 总结

本项目是一个完整的 CIFAR-10 图像分类项目，涵盖了深度学习的核心流程：
- 数据加载和预处理
- 模型定义和训练
- 模型评估和保存
- 模型推理和应用

通过这个项目，可以学习和实践 PyTorch 深度学习框架的基本使用方法，为更复杂的深度学习项目打下基础。

